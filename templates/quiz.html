{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mental Health Quiz</title>
    <link rel="stylesheet" href="{% static 'quiz.css' %}">
</head>
<body>
    <div class="quiz-container">
        <h2 class="quiz-title">Mental Health Quiz</h2>

        <div id="start-page">
            <p>This quiz has two stages where the first stage has more generalized questions about mental health issues. Please note that the main aim of this quiz is to analyze the user's mental health issue based on their responses. Don't panic and follow the recommendations provided at the end.</p>
            <button id="start-btn" class="next-btn" onclick="startQuiz()">Start Quiz</button>
            <p id="click-start">Click the start button to begin.</p>
        </div>

        <div id="quizplace" style="display: none;">
            <div class="quiz-box">
                <div class="question">
                    <h3 id="question-text"></h3>
                </div>
                <div id="options-container" class="options"></div>
                <button id="next-btn" class="next-btn" onclick="submitResponse()">Next</button>
            </div>
        </div>

        <div id="completion-message" class="hidden">
            <h3>Thank you for completing the quiz!</h3>
            <p>Your responses have been recorded.</p>
            <div id="disorder-scores"></div>
        </div>
    </div>

    <script>
        const quizData = JSON.parse(`{{ quiz_data|safe }}`);

        let currentQuestionIndex = 0;
        let selectedOptionId = null;
        const threshold = 5; // Threshold value for disorders
        const identifiedDisorders = []; // Disorders exceeding the threshold
        let stage = 1; // Current stage of the quiz

        const disorderScores = {
            "Depression": 0,
            "Mood Disorder": 0,
            "Anxiety": 0,
            "Somatic Disorder": 0,
            "Trauma": 0,
            "Stress": 0,
            "Obsessive Compulsive": 0,
            "Psychotic": 0,
            "Dissociative": 0,
            "Neurocognitive": 0,
            "Neurodevelopmental": 0,
            "Substance Use": 0,
            "Personality": 0,
            "Sleep-Wake": 0,
            "Self-Harm": 0,
            "Eating": 0
        };

        // Function to filter questions for each stage
        function filterQuestions(stage) {
            if (stage === 1) {
                return quizData.filter(question => question.name === "stage_1");
            } else {
                return quizData.filter(question => identifiedDisorders.includes(question.name));
            }
        }

        // Function to display a question
        function displayQuestion(question) {
            document.getElementById('question-text').textContent = question.text;
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = ''; // Clear existing options
            selectedOptionId = null;

            question.options.forEach(option => {
                const optionButton = document.createElement('button');
                optionButton.textContent = option.text;
                optionButton.classList.add('next-btn');
                optionButton.onclick = () => selectOption(optionButton, option);
                optionsContainer.appendChild(optionButton);
            });
        }

        // Function to handle option selection
        function selectOption(button, option) {
            const options = document.querySelectorAll('.next-btn');
            options.forEach(opt => opt.classList.remove('selected-option'));
            button.classList.add('selected-option');
            selectedOptionId = option.id;

            Object.keys(disorderScores).forEach(disorder => {
                disorderScores[disorder] += option.disorders[disorder] || 0;
            });
        }

        // Function to submit a response
        function submitResponse() {
            if (!selectedOptionId) {
                alert('Please select an option.');
                return;
            }

            currentQuestionIndex++;
            loadNextQuestion();
        }

        // Function to check disorder scores after stage 1
        function checkDisorders() {
            for (const [disorder, score] of Object.entries(disorderScores)) {
                if (score > threshold) {
                    identifiedDisorders.push(disorder);
                }
            }
        }

        // Function to show completion message
        function showCompletionMessage() {
            document.getElementById('quizplace').style.display = 'none';
            document.getElementById('completion-message').style.display = 'block';

            const disorderScoresDiv = document.getElementById('disorder-scores');
            disorderScoresDiv.innerHTML = '<h4>Disorder Scores:</h4><ul>';

            for (const [disorder, score] of Object.entries(disorderScores)) {
                disorderScoresDiv.innerHTML += `<li>${disorder}: ${score}</li>`;
            }

            disorderScoresDiv.innerHTML += '</ul>';
        }

        // Function to start the quiz
        function startQuiz() {
            document.getElementById('start-page').style.display = 'none';
            document.getElementById('quizplace').style.display = 'block';
            loadNextQuestion();
        }

        // Function to load the next question
        function loadNextQuestion() {
            const filteredQuestions = filterQuestions(stage);

            if (currentQuestionIndex < filteredQuestions.length) {
                const question = filteredQuestions[currentQuestionIndex];
                displayQuestion(question);
            } else if (stage === 1) {
                // Move to stage 2
                checkDisorders();
                if (identifiedDisorders.length > 0) {
                    stage = 2;
                    currentQuestionIndex = 0;
                    loadNextQuestion();
                } else {
                    showCompletionMessage();
                }
            } else {
                showCompletionMessage();
            }
        }

    </script>
</body>
</html>




















{% comment %} {% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mental Health Quiz</title>
    <link rel="stylesheet" href="{% static 'quiz.css' %}">
</head>
<body>
    <div class="quiz-container">
        <h2 class="quiz-title">Mental Health Quiz</h2>

        <div id="start-page">
            <p>This quiz has two stages where the first stage has more generalized questions about mental health issues. Please note that the main aim of this quiz is to analyze the user's mental health issue based on their responses. Don't panic and follow the recommendations provided at the end.</p>
            <button id="start-btn" class="next-btn" onclick="startQuiz()">Start Quiz</button>
            <p id="click-start">Click the start button to begin.</p>
        </div>

        <div id="quizplace" style="display: none;">
            <div class="quiz-box">
                <div class="question">
                    <h3 id="question-text"></h3>
                </div>
                <div id="options-container" class="options"></div>
                <button id="next-btn" class="next-btn" onclick="submitResponse()">Next</button>
            </div>
        </div>

        <div id="completion-message" class="hidden">
            <h3>Thank you for completing the quiz!</h3>
            <p>Your responses have been recorded.</p>
            <div id="disorder-scores"></div>
        </div>
    </div>

    <script>
        const quizData = JSON.parse(`{{ quiz_data|safe }}`);

        let currentQuestionIndex = 0;
        let selectedOptionId = null;
        const disorderScores = {
            "Depression": 0,
            "Mood Disorder": 0,
            "Anxiety": 0,
            "Somatic Disorder": 0,
            "Trauma": 0,
            "Stress": 0,
            "Obsessive Compulsive": 0,
            "Psychotic": 0,
            "Dissociative": 0,
            "Neurocognitive": 0,
            "Neurodevelopmental": 0,
            "Substance Use": 0,
            "Personality": 0,
            "Sleep-Wake": 0,
            "Self-Harm": 0,
            "Eating": 0
        };

        function displayQuestion(question) {
            document.getElementById('question-text').textContent = question.text;
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = ''; // Clear existing options
            selectedOptionId = null;
        
            question.options.forEach(option => {
                const optionButton = document.createElement('button');
                optionButton.textContent = option.text;
                optionButton.classList.add('next-btn');
                optionButton.onclick = () => selectOption(optionButton, option);
                optionsContainer.appendChild(optionButton);
            });
        }
        

        function selectOption(button, option) {
            const options = document.querySelectorAll('.next-btn');
            options.forEach(opt => opt.classList.remove('selected-option'));
            button.classList.add('selected-option');
            selectedOptionId = option.id;

            Object.keys(disorderScores).forEach(disorder => {
                disorderScores[disorder] += option.disorders[disorder] || 0;
            });
        }

        function submitResponse() {
            if (!selectedOptionId) {
                alert('Please select an option.');
                return;
            }
            currentQuestionIndex++;
            loadNextQuestion();
        }

        function showCompletionMessage() {
            document.getElementById('quizplace').style.display = 'none';
            document.getElementById('completion-message').style.display = 'block';
        
            const disorderScoresDiv = document.getElementById('disorder-scores');
            disorderScoresDiv.innerHTML = '<h4>Disorder Scores:</h4><ul>';
        
            for (const [disorder, score] of Object.entries(disorderScores)) {
                disorderScoresDiv.innerHTML += `<li>${disorder}: ${score}</li>`;
            }
        
            disorderScoresDiv.innerHTML += '</ul>';
        }
        

        function startQuiz() {
            document.getElementById('start-page').style.display = 'none';
            document.getElementById('quizplace').style.display = 'block';
            loadNextQuestion();
        }

        function loadNextQuestion() {
            if (currentQuestionIndex < quizData.length) {
                const question = quizData[currentQuestionIndex];
                displayQuestion(question);
            } else {
                showCompletionMessage();
            }
        }
    </script>
</body>
</html> {% endcomment %}
